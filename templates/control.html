
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="http://static.opentok.com/v1.1/js/TB.min.js" ></script>
<script src="/static/assets/js/libopentok.js"></script>

<script>

// case 'wasd':
up_key = 87; 	//w
left_key = 65; 	//a
down_key = 83; 	//s
right_key = 68; //d
stop_key = 90; 	//z
reset_key = 82; //r

$(function() {
    if ("WebSocket" in window) {
        ws = new WebSocket("ws://localhost:8000/websocket");
        ws.onmessage = function (msg) {
            var message = JSON.parse(msg.data);
            $("p#log").html(message.output);
        };
    };
    
    window.onbeforeunload = function() {
        ws.onclose = function () {};
       	ws.close();
        leave_page();
    };


    $(document).keydown(function(event){
	switch (event.keyCode) {
		case left_key:
			$("#currentKey").text("left");
			ws.send(JSON.stringify({'output': 'left'}));
			break;
		case up_key:
			$("#currentKey").text("up");
			ws.send(JSON.stringify({'output': 'up'}));
			break;
		case right_key:
			$("#currentKey").text("right");
			ws.send(JSON.stringify({'output': 'right'}));
			break;
		case down_key:
			$("#currentKey").text("down");
			ws.send(JSON.stringify({'output': 'down'}));
			break;
		case stop_key:
			$("#currentKey").text("stop");
			ws.send(JSON.stringify({'output': 'stop'}));
			break;
		case reset_key:
			$("#currentKey").text("reset");
			ws.send(JSON.stringify({'output': 'reset'}));
			break;	
	}});
});

function leave_page()
{
	//alert('leaving now');
	self.location='/leave';
}

</script>

<script>
	// initializing opentok
	window.opentok.init();
</script>

<style>
	input {
	    font-size: 48px; 
	    width: 600px;
	    border-style: none; 
	    background-color: transparent; 
	    border-style: solid; 
	    border-width: 0px 0px 1px 0px; 
	}
	textarea:focus, input:focus{
	    outline: 0;
	}
</style>

{% extends "control-base.html" %}

{% block subtitle %}- Control{% endblock %}

{% block nav %}
{% endblock %}

{% block content %}

<h2 id="signupmain"> Roomba as a Service.</h2>

<div id="video_chat_container">
  <div id="video_chat_self"></div>
</div>

<h4>To Control, press WASD (Z to stop)</h4>

Current Control: <span id="currentKey"> </span>

<br>

Server says: <p id="log"></p>

When you are done, press <button id="leave" onClick="leave_page()">Leave</button>

{% endblock %}